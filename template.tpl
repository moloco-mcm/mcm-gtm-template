___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "MCM User Event API",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "api_key",
    "displayName": "MCM user event api key",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "api_url",
    "displayName": "MCM api url",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "id",
    "displayName": "event id",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "timestamp",
    "displayName": "timestamp",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "event_type",
    "displayName": "event type",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "channel_type",
    "displayName": "channel type",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "user_id",
    "displayName": "user id",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "page_id",
    "displayName": "page id",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "items",
    "displayName": "items",
    "description": "items info retrieved from Ecommerce data",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "currency",
    "displayName": "currency",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "value",
    "displayName": "total value(revenue)",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "search_term",
    "displayName": "search_term",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "persistent_id",
    "displayName": "persistent_id",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "os",
    "displayName": "os",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_SERVER___

const sendHttpRequest = require('sendHttpRequest');
const setResponseBody = require('setResponseBody');
const setResponseHeader = require('setResponseHeader');
const setResponseStatus = require('setResponseStatus');
const logToConsole = require('logToConsole');
const JSON = require('JSON');

// capture values of template fields
const apiUrl = data.api_url;
const key = data.api_key;

if (!data.os || !data.persistent_id) {
  logToConsole('Missing required device info: os or persistent_id', { os: data.os, persistent_id: data.persistent_id });
  data.gtmOnFailure();
  return;
}
const jsonPayloadObject = {
  event_type: data.event_type,
  channel_type: data.channel_type,
  id: data.id,
  user_id: data.user_id,
  page_id: data.page_id,
  timestamp: data.timestamp,
//device info by OS and persistent_id from template fields
  device: {
    os: data.os,
    persistent_id: data.persistent_id
  }
};

//list of supported event_type
const supportedEvents = ['ADD_TO_CART', 'ADD_TO_WISHLIST', 'VIEW_ITEM', 'PURCHASE', 'SEARCH', 'HOME', 'PAGE_VIEW'];
//validating event_type
if (supportedEvents.indexOf(data.event_type) === -1) {
  logToConsole('Unsupported event type:', data.event_type);
  data.gtmOnFailure();
  return;
}
//list of event_type require item info
const itemEvents = ['ADD_TO_CART', 'ADD_TO_WISHLIST', 'VIEW_ITEM', 'PURCHASE'];

// Check for required items array for itemEvents
if (itemEvents.indexOf(data.event_type) !== -1) {
  if (!(data.items && typeof data.items.length === 'number' && data.items.length > 0)) {
    logToConsole('Error: items array is missing or empty', data.items);
    data.gtmOnFailure();
    return;
  }
}


// Add the `items` field 
if (data.event_type == "ADD_TO_CART" || data.event_type == "ADD_TO_WISHLIST") {
  jsonPayloadObject.items = data.items.map(function(item) {
    const itemObject = {
      quantity: item.quantity,
      id: item.item_id
    };
    if (item.price !== undefined) {
      itemObject.price = {
        currency: data.currency,
        amount: item.price
      };
    }
    return itemObject;
  });
}
// Add the `items` field only with item_id
if (data.event_type == "VIEW_ITEM") {
  jsonPayloadObject.event_type = 'ITEM_PAGE_VIEW';
  jsonPayloadObject.items = data.items.map(function(item) {
    
    return {
      id: item.item_id
    };
  });
}
// Add the `items` field with 'revenue' field
if (data.event_type == "PURCHASE") {
  jsonPayloadObject.items = data.items.map(function(item) {
    return {
      price: {
        currency: data.currency,
        amount: item.price
      },
      quantity: item.quantity,
      id: item.item_id
    };
  });
  jsonPayloadObject.revenue = {
    currency: data.currency,
    amount: data.value
  };
}
// Add the `search_query` field 
if (data.event_type == "SEARCH") {
  jsonPayloadObject.search_query = data.search_term;
}
//event_type: HOME, PAGEVIEW goes without additional payload

// Convert the object to JSON string
const jsonPayload = JSON.stringify(jsonPayloadObject, null, 2);

logToConsole('JSON body', jsonPayload);

const apiMethod = 'POST';     
const headers = {
  'Content-Type': 'application/json',
  'X-API-Key': key  // Api key
};


// Send the HTTP request using sendHttpRequest 
sendHttpRequest(apiUrl, {
  headers: headers,
  method: apiMethod,
  timeout: 1000
}, jsonPayload).then((result) => {
  const statusCode = result.statusCode;
  const responseBody = result.responseText;

  if (statusCode >= 200 && statusCode < 300) {
    logToConsole('API call successful', responseBody);
    data.gtmOnSuccess();
  } else {
    logToConsole('API call failed with status', statusCode, responseBody);
    data.gtmOnFailure();
  }
}).catch((error) => {
  logToConsole('HTTP request error', error);
  data.gtmOnFailure();
});


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_response",
        "versionId": "1"
      },
      "param": [
        {
          "key": "writeResponseAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "writeHeaderAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://evt-sel.rmp-api.moloco.com/rmp/event/v1/platforms/MOLOCO_SHOP_DEMO/userevents"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 5/19/2025, 3:54:28 PM


